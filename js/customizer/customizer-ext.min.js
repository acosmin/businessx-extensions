var $=window.jQuery;api=wp.customize||{},window.BxExtensions={v:{panel:"businessx_panel__sections",admin:bxext_widgets_customizer.admin_url,icons:bxext_widgets_customizer.icons,sections:bxext_widgets_customizer.sections,sections_position:bxext_widgets_customizer.sections_position,msgs:bxext_widgets_customizer.msgs,actions:$("#customize-header-actions"),mod:"businessx_sections_position"},init:function(){var e=this;e.initFirstViewModal(),e.initSortableSections(),e.backup()},initSortableSections:function(){var o=this,a=$(o.panelSections());a.sortable({helper:"clone",items:"> li.control-section:not(.cannot-expand)",cancel:"li.ui-sortable-handle.open",delay:150,axis:"y",update:function(e,n){var t,i=o.getPanelSections(),s=o.sectionsArray();t=_.union(s,i),_.each(t,function(e,n){api.section(e).priority.set(n+1)}),a.find(".bx_drag_and_spinner").show(),o.setSectionsPosition(t),$(".wp-full-overlay-sidebar-content").scrollTop(0)}})},getPanelSections:function(){var n=api.panel(this.v.panel),t=[];return api.section.each(function(e){e.panel.get()===n.id&&t.push(e.id)}),t.shift(),t},panelHandle:function(){return api.panel(this.v.panel).container.get(0)},panelSections:function(){return api.panel(this.v.panel).contentContainer},sectionsArray:function(){var e=this.panelSections();items=$(e).sortable("toArray");for(var n=0;n<items.length;n++)items[n]=items[n].replace("accordion-section-","");return items},setSectionsPosition:function(e){var n=$(this.panelSections());e=JSON.stringify(e),api(this.v.mod).set(e),setTimeout(function(){n.find(".bx_drag_and_spinner").hide()},500)},backup:function(){var e=this.v.actions,n=this.v.msgs,t=$(document),i=e.find(".save");e.prepend('<a href="#" class="customize-controls-close bx-backup-sections"><span class="bx-backup-pulse"></span><span class="bx-backup-bubble">'+n.bk_bubble+"</span></a>"),t.on("click",".bx-backup-sections",function(e){e.preventDefault(),!0===i.is(":disabled")?$.ajax({url:ajaxurl,type:"post",dataType:"json",data:{action:"businessx_extensions_sections_bk",n_sections_bk:bxext_customizer_nonces.n_sections_bk}}).done(function(e){$(".bx-backup-pulse").hide(),alert(n.bk_success),t.trigger("bx-backup-success")}):alert(n.bk_fail)}),t.on("widget-added widget-updated",function(e){$(".bx-backup-pulse").show()}),t.on("click",".bx-restore-sections",function(e){e.preventDefault(),!0===i.is(":disabled")?$.ajax({url:ajaxurl,type:"post",dataType:"json",data:{action:"businessx_extensions_sections_rt",n_sections_rt:bxext_customizer_nonces.n_sections_rt}}).done(function(e){alert(n.bk_restore_success),location.reload(!0)}):alert(n.bk_fail)})},initFirstViewModal:function(){if(!(0<$("#businessx-frontpage-modal").length))return!1;$.magnificPopup.open({items:{src:"#businessx-frontpage-modal",type:"inline"},modal:!0,preloader:!1,focus:"#bxext-insert-frontpage"},0),$("#bxext-insert-frontpage").on("click",function(e){e.preventDefault(),$.ajax({url:ajaxurl,type:"post",dataType:"json",data:{action:"bxext_create_frontpage",bxext_create_frontpage:bxext_customizer_nonces.bxext_create_frontpage}}).done(function(e){$.magnificPopup.close(),location.reload(!0)})}),$("#bxext-dismiss-frontpage").on("click",function(e){e.preventDefault(),$.ajax({url:ajaxurl,type:"post",dataType:"json",data:{action:"bxext_dismiss_create_frontpage",bxext_create_frontpage:bxext_customizer_nonces.bxext_dismiss_create_frontpage}}).done(function(e){$.magnificPopup.close(),location.reload(!0)})})}},$(document).ready(function(e){window.BxExtensions.init()});